<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HyphaMind API</title>
  <link rel="icon" href="assets/img/favicon.ico">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a class="brand" href="index.html">
        <img src="assets/logo.svg" alt="HyphaMind logo">
        <span>HyphaMind</span>
      </a>
      <p class="tagline">APIs expose the consent-first controls of HyphaMind. Every route respects ROOT receipts and VALVE guards.</p>
    </div>
    <nav class="site-nav">
      <a href="index.html">Home</a>
      <a href="quickstart.html">Quickstart</a>
      <a href="architecture.html">Architecture</a>
      <a href="primitives.html">Primitives</a>
      <a href="chorus.html">Chorus</a>
      <a href="telemetry-consent.html">Telemetry &amp; Consent</a>
      <a href="ci-covenant.html">CI Covenant</a>
      <a href="api.html" class="active">API</a>
      <a href="glossary.html">Glossary</a>
      <a href="dashboard.html">Dashboard</a>
    </nav>
  </header>
  <main class="container">
    <section class="section">
      <h1>Routes</h1>
      <p class="lead">HyphaMind exposes a minimal API surface aimed at operators and orchestrators. Every route expects consent receipts in headers and payloads.</p>
      <div class="card table-card" data-accent="teal">
        <table>
          <thead>
            <tr>
              <th>Route</th>
              <th>Description</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="code-inline">POST /chorus/storm/run</span></td>
              <td>Start a Chorus-managed run with ROOT receipts.</td>
              <td>Requires <span class="code-inline">root.digest</span> and <span class="code-inline">consent_envelope_id</span>.</td>
            </tr>
            <tr>
              <td><span class="code-inline">POST /chorus/eye/refrain</span></td>
              <td>Manually trigger a REFRAIN pause with operator note.</td>
              <td>ECE threshold optional; defaults to 0.08.</td>
            </tr>
            <tr>
              <td><span class="code-inline">POST /chorus/cart/query</span></td>
              <td>Query cart geometry and evidence paths.</td>
              <td>Only SPORE-vetted nodes are returned.</td>
            </tr>
            <tr>
              <td><span class="code-inline">POST /chorus/bard/brief</span></td>
              <td>Generate a human-readable briefing for auditors.</td>
              <td>Requires SCAR marker and operator note.</td>
            </tr>
            <tr>
              <td><span class="code-inline">POST /chorus/song/state</span></td>
              <td>Retrieve the current run state, including REFRAIN status.</td>
              <td>Includes policy latency and consent coverage metrics.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="section">
      <h2>VALVE guard pseudocode</h2>
      <div class="card" data-accent="gold">
        <pre><code>def valve_guard(request):
    envelope = request.json
    required = ["consent_envelope_id", "trace_span_id", "root.digest"]
    for field in required:
        if field not in envelope or not envelope[field]:
            raise Refusal(
                code="VALVE.MISSING_FIELD",
                reason=f"{field} required before reach"
            )

    if envelope.get("export.intent") == "public":
        if not envelope.get("c2pa.manifest"):
            raise Refusal(
                code="VALVE.MISSING_C2PA",
                reason="Public exports require C2PA manifest"
            )

    if not envelope.get("trace_span_id").startswith("trace-"):
        raise Refusal(code="VALVE.BAD_TRACE", reason="Trace ID malformed")

    return allow()
</code></pre>
        <p class="small">VALVE never forwards envelopes without consent receipts or traceability. Public exports also require a valid C2PA manifest, enforcing authenticity at the edge.</p>
      </div>
    </section>
  </main>
  <footer class="footer">
    <div class="container">
      <strong>HyphaMind</strong>
      <small>Consent-first orchestration spine for multi-agent systems.</small>
      <small>&copy; 2024 HyphaMind Collective.</small>
    </div>
  </footer>
</body>
</html>
